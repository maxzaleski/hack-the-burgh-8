import { OnboardingHeader, WhiteButton } from '../common';
import React from 'react';
import { OnboardingInput } from '../common/OnboardingInput';
import { API_USERS_PATH } from '@lib/common';
import { useAuth } from '@hooks';
import { useFormik } from 'formik';
import * as Yup from 'yup';
import router from 'next/router';

export const CompleteDetailsStep = (props) => {
  const [loading, setLoading] = React.useState(false);
  const { tokenClaims } = useAuth();

  const formik = useFormik({
    initialValues: {
      pronouns: '',
      jobTitle: '',
      andTitle: '',
    },
    validationSchema: Yup.object({
      jobTitle: Yup.string().required('Field is required'),
      andTitle: Yup.string().required('Field is required'),
    }),
    onSubmit: (values) => {
      setLoading(true);
      fetch(API_USERS_PATH + `/${tokenClaims?.uid}`, {
        method: 'PUT',
        headers: {
          'Content-type': 'application/json',
          Accept: '*/*',
        },
        body: JSON.stringify(values),
      })
        .then(() => router.push('/'))
        .catch((err) => console.log(err, err.stack))
        .finally(() => setLoading(false));
    },
  });

  return (
    <OnboardingHeader step="2/2">
      <form onSubmit={formik.handleSubmit} className="flex flex-col w-full">
        <svg
          width="335"
          height="132"
          viewBox="0 0 335 132"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          className="mb-[56px]">
          <g clipPath="url(#clip0_68_256)">
            <path
              d="M39.1142 27.7809H28.3215C28.245 26.8819 28.0408 26.0664 27.7091 25.3343C27.3902 24.6023 26.9437 23.973 26.3696 23.4465C25.8083 22.9071 25.1258 22.4962 24.322 22.2136C23.5183 21.9183 22.6062 21.7705 21.5856 21.7705C19.7996 21.7705 18.2877 22.2072 17.0503 23.0805C15.8255 23.9538 14.8943 25.206 14.2564 26.8369C13.6313 28.4679 13.3187 30.4264 13.3187 32.7123C13.3187 35.1268 13.6377 37.1494 14.2756 38.7804C14.9262 40.3985 15.8639 41.6186 17.0886 42.4405C18.3132 43.2495 19.7868 43.6541 21.509 43.6541C22.4913 43.6541 23.3716 43.5321 24.1498 43.2882C24.928 43.0313 25.6041 42.6652 26.1782 42.1901C26.7523 41.7149 27.218 41.1434 27.5751 40.4757C27.9452 39.7949 28.1939 39.0309 28.3215 38.1833L39.1142 38.2603C38.9867 39.9298 38.521 41.6315 37.7173 43.3652C36.9137 45.0861 35.7718 46.6786 34.2919 48.1426C32.8249 49.5938 31.0069 50.7624 28.8382 51.6485C26.6694 52.5347 24.1498 52.9778 21.2794 52.9778C17.6818 52.9778 14.4542 52.2008 11.5965 50.6469C8.75157 49.0929 6.49989 46.8069 4.84142 43.7889C3.19571 40.771 2.37286 37.0788 2.37286 32.7123C2.37286 28.3203 3.21485 24.6216 4.89883 21.6165C6.58281 18.5985 8.85363 16.3189 11.7113 14.7779C14.569 13.2239 17.7583 12.4469 21.2794 12.4469C23.7543 12.4469 26.0315 12.7873 28.111 13.4679C30.1905 14.1485 32.0147 15.1439 33.5839 16.4538C35.1531 17.7509 36.4161 19.3498 37.3729 21.2505C38.3297 23.1511 38.9102 25.3279 39.1142 27.7809ZM57.1775 52.9778C53.9881 52.9778 51.258 52.3421 48.9872 51.0706C46.7164 49.7864 44.9749 48.0013 43.763 45.7153C42.5511 43.4165 41.9451 40.7518 41.9451 37.7209C41.9451 34.6901 42.5511 32.0317 43.763 29.7458C44.9749 27.447 46.7164 25.6618 48.9872 24.3905C51.258 23.1062 53.9881 22.4641 57.1775 22.4641C60.3668 22.4641 63.0969 23.1062 65.3677 24.3905C67.6385 25.6618 69.3799 27.447 70.5919 29.7458C71.8039 32.0317 72.4098 34.6901 72.4098 37.7209C72.4098 40.7518 71.8039 43.4165 70.5919 45.7153C69.3799 48.0013 67.6385 49.7864 65.3677 51.0706C63.0969 52.3421 60.3668 52.9778 57.1775 52.9778ZM57.254 45.1182C58.147 45.1182 58.9188 44.8164 59.5694 44.2128C60.2201 43.6092 60.724 42.7488 61.0812 41.6315C61.4384 40.5142 61.6171 39.1849 61.6171 37.6439C61.6171 36.0899 61.4384 34.7607 61.0812 33.6563C60.724 32.539 60.2201 31.6786 59.5694 31.0749C58.9188 30.4713 58.147 30.1695 57.254 30.1695C56.31 30.1695 55.4999 30.4713 54.8237 31.0749C54.1476 31.6786 53.6309 32.539 53.2737 33.6563C52.9165 34.7607 52.7379 36.0899 52.7379 37.6439C52.7379 39.1849 52.9165 40.5142 53.2737 41.6315C53.6309 42.7488 54.1476 43.6092 54.8237 44.2128C55.4999 44.8164 56.31 45.1182 57.254 45.1182ZM75.6185 52.4384V22.8493H85.6459V28.4743H85.9521C86.5644 26.6251 87.6105 25.1609 89.0904 24.0822C90.5703 23.0035 92.3306 22.4641 94.3721 22.4641C96.4387 22.4641 98.2187 23.0163 99.7114 24.1208C101.203 25.2124 102.103 26.6636 102.409 28.4743H102.716C103.213 26.6636 104.272 25.2124 105.892 24.1208C107.513 23.0163 109.413 22.4641 111.594 22.4641C114.414 22.4641 116.698 23.3759 118.445 25.1995C120.206 27.0231 121.086 29.4504 121.086 32.4812V52.4384H110.523V35.1781C110.523 33.881 110.198 32.8665 109.547 32.1344C108.897 31.3895 108.023 31.0171 106.925 31.0171C105.841 31.0171 104.98 31.3895 104.342 32.1344C103.717 32.8665 103.404 33.881 103.404 35.1781V52.4384H93.3006V35.1781C93.3006 33.881 92.9755 32.8665 92.3243 32.1344C91.6741 31.3895 90.8002 31.0171 89.7028 31.0171C88.9756 31.0171 88.3505 31.1841 87.8274 31.518C87.3044 31.8519 86.8962 32.3335 86.6027 32.9628C86.322 33.5792 86.1817 34.3177 86.1817 35.1781V52.4384H75.6185ZM125.218 63.5342V22.8493H135.705V28.012H135.935C136.317 27.0103 136.878 26.0921 137.619 25.2573C138.359 24.4097 139.276 23.7354 140.374 23.2346C141.471 22.7209 142.747 22.4641 144.201 22.4641C146.14 22.4641 147.984 22.9842 149.731 24.0244C151.492 25.0647 152.921 26.7021 154.018 28.9367C155.128 31.1713 155.682 34.0736 155.682 37.6439C155.682 41.06 155.153 43.8917 154.095 46.1392C153.048 48.3866 151.645 50.0626 149.884 51.167C148.136 52.2714 146.217 52.8236 144.125 52.8236C142.747 52.8236 141.515 52.5989 140.431 52.1494C139.36 51.6871 138.441 51.0642 137.676 50.2808C136.923 49.4847 136.342 48.5856 135.935 47.5839H135.781V63.5342H125.218ZM135.552 37.6439C135.552 39.0822 135.737 40.3279 136.107 41.381C136.49 42.4213 137.025 43.2303 137.714 43.8082C138.416 44.3733 139.251 44.6558 140.221 44.6558C141.19 44.6558 142.013 44.3797 142.689 43.8275C143.378 43.2625 143.902 42.4598 144.258 41.4195C144.628 40.3664 144.813 39.1079 144.813 37.6439C144.813 36.1798 144.628 34.9277 144.258 33.8874C143.902 32.8344 143.378 32.0317 142.689 31.4795C142.013 30.9144 141.19 30.6319 140.221 30.6319C139.251 30.6319 138.416 30.9144 137.714 31.4795C137.025 32.0317 136.49 32.8344 136.107 33.8874C135.737 34.9277 135.552 36.1798 135.552 37.6439ZM169.593 12.9863V52.4384H159.031V12.9863H169.593ZM187.982 52.9778C184.844 52.9778 182.139 52.3742 179.868 51.167C177.61 49.9469 175.869 48.2004 174.645 45.9273C173.432 43.6413 172.826 40.9058 172.826 37.7209C172.826 34.6644 173.438 31.9932 174.663 29.7073C175.888 27.4212 177.616 25.6426 179.849 24.3712C182.082 23.0998 184.716 22.4641 187.753 22.4641C189.972 22.4641 191.982 22.8108 193.78 23.5043C195.579 24.1978 197.116 25.206 198.392 26.5287C199.668 27.8386 200.651 29.4311 201.339 31.3061C202.028 33.1811 202.372 35.2937 202.372 37.6439V40.1096H176.117V34.2535H192.651C192.638 33.4059 192.422 32.661 192.001 32.0189C191.592 31.3639 191.037 30.8566 190.336 30.497C189.647 30.1246 188.863 29.9383 187.982 29.9383C187.128 29.9383 186.343 30.1246 185.629 30.497C184.914 30.8566 184.34 31.3574 183.906 31.9996C183.485 32.6417 183.262 33.393 183.236 34.2535V40.5719C183.236 41.5222 183.434 42.3699 183.83 43.1147C184.225 43.8596 184.792 44.444 185.532 44.8677C186.273 45.2916 187.165 45.5034 188.212 45.5034C188.939 45.5034 189.602 45.4007 190.202 45.1952C190.814 44.9898 191.337 44.6944 191.771 44.3091C192.205 43.911 192.523 43.4358 192.727 42.8836H202.372C202.041 44.9383 201.256 46.7235 200.018 48.2389C198.782 49.7414 197.142 50.9102 195.101 51.7449C193.072 52.5668 190.699 52.9778 187.982 52.9778ZM223.134 22.8493V30.5549H203.768V22.8493H223.134ZM207.519 15.7603H218.082V42.9221C218.082 43.3331 218.152 43.6798 218.292 43.9624C218.433 44.232 218.65 44.4376 218.943 44.5788C219.236 44.7072 219.613 44.7714 220.072 44.7714C220.391 44.7714 220.76 44.7329 221.182 44.6558C221.615 44.5788 221.934 44.5146 222.139 44.4632L223.669 51.9375C223.198 52.0788 222.522 52.2521 221.642 52.4576C220.774 52.6631 219.74 52.7979 218.541 52.8622C216.117 52.9906 214.082 52.7402 212.437 52.1109C210.791 51.4688 209.554 50.4606 208.725 49.0865C207.895 47.7123 207.493 45.9914 207.519 43.9238V15.7603ZM240.135 52.9778C236.997 52.9778 234.292 52.3742 232.021 51.167C229.763 49.9469 228.022 48.2004 226.797 45.9273C225.585 43.6413 224.979 40.9058 224.979 37.7209C224.979 34.6644 225.591 31.9932 226.817 29.7073C228.041 27.4212 229.77 25.6426 232.002 24.3712C234.235 23.0998 236.869 22.4641 239.905 22.4641C242.125 22.4641 244.134 22.8108 245.933 23.5043C247.732 24.1978 249.27 25.206 250.545 26.5287C251.821 27.8386 252.803 29.4311 253.492 31.3061C254.181 33.1811 254.525 35.2937 254.525 37.6439V40.1096H228.271V34.2535H244.804C244.792 33.4059 244.574 32.661 244.154 32.0189C243.745 31.3639 243.19 30.8566 242.489 30.497C241.8 30.1246 241.015 29.9383 240.135 29.9383C239.28 29.9383 238.496 30.1246 237.781 30.497C237.067 30.8566 236.493 31.3574 236.059 31.9996C235.638 32.6417 235.414 33.393 235.389 34.2535V40.5719C235.389 41.5222 235.587 42.3699 235.983 43.1147C236.378 43.8596 236.946 44.444 237.686 44.8677C238.426 45.2916 239.318 45.5034 240.365 45.5034C241.091 45.5034 241.755 45.4007 242.355 45.1952C242.967 44.9898 243.49 44.6944 243.924 44.3091C244.358 43.911 244.677 43.4358 244.88 42.8836H254.525C254.194 44.9383 253.409 46.7235 252.171 48.2389C250.934 49.7414 249.295 50.9102 247.253 51.7449C245.225 52.5668 242.852 52.9778 240.135 52.9778ZM9.10874 129.535C7.89682 129.535 6.74228 129.438 5.64514 129.245C4.548 129.065 3.58482 128.815 2.75558 128.494L5.05192 120.943C5.91942 121.251 6.71038 121.45 7.4248 121.539C8.15197 121.63 8.77071 121.578 9.281 121.386C9.80407 121.193 10.1804 120.827 10.41 120.287L10.6397 119.748L0.306152 88.8493H11.3285L16.0743 109.346H16.3805L21.2029 88.8493H32.3018L21.5856 120.904C21.0497 122.535 20.2715 124 19.251 125.296C18.2431 126.606 16.9163 127.64 15.2706 128.398C13.625 129.156 11.5709 129.535 9.10874 129.535ZM47.4945 118.978C44.3052 118.978 41.5751 118.342 39.3043 117.07C37.0335 115.787 35.2921 114.001 34.0802 111.715C32.8681 109.416 32.2622 106.752 32.2622 103.721C32.2622 100.69 32.8681 98.0317 34.0802 95.7461C35.2921 93.447 37.0335 91.6623 39.3043 90.3905C41.5751 89.1062 44.3052 88.4641 47.4945 88.4641C50.6839 88.4641 53.414 89.1062 55.6848 90.3905C57.9557 91.6623 59.6971 93.447 60.909 95.7461C62.1209 98.0317 62.727 100.69 62.727 103.721C62.727 106.752 62.1209 109.416 60.909 111.715C59.6971 114.001 57.9557 115.787 55.6848 117.07C53.414 118.342 50.6839 118.978 47.4945 118.978ZM47.5711 111.118C48.4641 111.118 49.236 110.817 49.8866 110.213C50.5372 109.609 51.0411 108.749 51.3983 107.632C51.7555 106.514 51.9341 105.185 51.9341 103.644C51.9341 102.09 51.7555 100.76 51.3983 99.6564C51.0411 98.5389 50.5372 97.6782 49.8866 97.0752C49.236 96.4712 48.4641 96.1693 47.5711 96.1693C46.627 96.1693 45.8169 96.4712 45.1408 97.0752C44.4647 97.6782 43.948 98.5389 43.5907 99.6564C43.2336 100.76 43.0549 102.09 43.0549 103.644C43.0549 105.185 43.2336 106.514 43.5907 107.632C43.948 108.749 44.4647 109.609 45.1408 110.213C45.8169 110.817 46.627 111.118 47.5711 111.118ZM84.9953 105.493V88.8493H95.5585V118.438H85.5311V112.813H85.225C84.587 114.701 83.4707 116.178 81.8761 117.244C80.2814 118.297 78.3869 118.824 76.1926 118.824C74.1387 118.824 72.3399 118.349 70.7962 117.398C69.2654 116.448 68.0725 115.137 67.2178 113.468C66.3758 111.799 65.9484 109.885 65.9357 107.727V88.8493H76.4988V105.493C76.5116 106.957 76.8816 108.106 77.6087 108.942C78.3487 109.776 79.382 110.194 80.7087 110.194C81.5891 110.194 82.3481 110.008 82.986 109.635C83.6366 109.25 84.1342 108.71 84.4786 108.017C84.8358 107.311 85.0081 106.469 84.9953 105.493ZM99.8533 118.438V88.8493H110.11V94.474H110.416C110.952 92.3937 111.8 90.8721 112.961 89.9088C114.135 88.9457 115.507 88.4641 117.076 88.4641C117.535 88.4641 117.988 88.5026 118.435 88.5796C118.894 88.6439 119.334 88.7402 119.755 88.8686V97.9422C119.232 97.7623 118.587 97.6276 117.822 97.5372C117.057 97.4477 116.399 97.4025 115.851 97.4025C114.818 97.4025 113.886 97.6402 113.058 98.1149C112.24 98.5778 111.596 99.2324 111.125 100.08C110.652 100.915 110.416 101.898 110.416 103.028V118.438H99.8533Z"
              fill="white"
            />
            <path d="M339.421 74.7727H133.82V131.364H339.421V74.7727Z" fill="white" />
            <path
              d="M142.237 120.555V85.8714H157.109C159.666 85.8714 161.903 86.3794 163.82 87.3956C165.739 88.4116 167.23 89.8398 168.296 91.6802C169.361 93.5201 169.893 95.671 169.893 98.132C169.893 100.616 169.344 102.767 168.245 104.585C167.158 106.403 165.626 107.802 163.652 108.784C161.69 109.767 159.396 110.258 156.772 110.258H147.889V102.942H154.888C155.987 102.942 156.924 102.75 157.697 102.366C158.482 101.971 159.082 101.412 159.498 100.69C159.923 99.9673 160.136 99.1147 160.136 98.132C160.136 97.1393 159.923 96.2921 159.498 95.5923C159.082 94.8808 158.482 94.3392 157.697 93.9667C156.924 93.5825 155.987 93.3908 154.888 93.3908H151.591V120.555H142.237ZM172.378 120.555V85.8714H187.25C189.807 85.8714 192.045 86.3399 193.962 87.277C195.88 88.2141 197.371 89.5633 198.437 91.3249C199.503 93.0861 200.035 95.1972 200.035 97.6582C200.035 100.142 199.486 102.237 198.386 103.941C197.299 105.646 195.767 106.933 193.794 107.802C191.831 108.671 189.537 109.106 186.914 109.106H178.031V101.79H185.029C186.128 101.79 187.065 101.655 187.839 101.384C188.624 101.102 189.224 100.655 189.639 100.046C190.064 99.4366 190.278 98.6401 190.278 97.6582C190.278 96.6646 190.064 95.8572 189.639 95.2361C189.224 94.6041 188.624 94.1412 187.839 93.8483C187.065 93.5427 186.128 93.3908 185.029 93.3908H181.732V120.555H172.378ZM192.566 104.635L201.18 120.555H191.018L182.606 104.635H192.566ZM236.452 103.213C236.452 107.074 235.706 110.331 234.214 112.985C232.723 115.626 230.709 117.631 228.174 118.996C225.64 120.351 222.814 121.029 219.696 121.029C216.555 121.029 213.718 120.346 211.184 118.98C208.66 117.602 206.653 115.593 205.161 112.95C203.681 110.298 202.94 107.051 202.94 103.213C202.94 99.3516 203.681 96.1004 205.161 93.4586C206.653 90.8051 208.66 88.8012 211.184 87.4464C213.718 86.0803 216.555 85.3972 219.696 85.3972C222.814 85.3972 225.64 86.0803 228.174 87.4464C230.709 88.8012 232.723 90.8051 234.214 93.4586C235.706 96.1004 236.452 99.3516 236.452 103.213ZM226.829 103.213C226.829 101.135 226.554 99.386 226.005 97.9629C225.467 96.529 224.665 95.445 223.598 94.7117C222.545 93.9667 221.244 93.5942 219.696 93.5942C218.148 93.5942 216.842 93.9667 215.776 94.7117C214.722 95.445 213.92 96.529 213.371 97.9629C212.832 99.386 212.563 101.135 212.563 103.213C212.563 105.291 212.832 107.046 213.371 108.479C213.92 109.903 214.722 110.986 215.776 111.732C216.842 112.465 218.148 112.832 219.696 112.832C221.244 112.832 222.545 112.465 223.598 111.732C224.665 110.986 225.467 109.903 226.005 108.479C226.554 107.046 226.829 105.291 226.829 103.213ZM239.832 120.555V85.8714H264.057V93.4586H249.185V99.4194H262.576V107.007H249.185V120.555H239.832ZM275.903 85.8714V120.555H266.55V85.8714H275.903ZM279.389 120.555V85.8714H288.742V112.967H302.672V120.555H279.389ZM305.506 120.555V85.8714H330.336V93.4586H314.859V99.4194H329.057V107.007H314.859V112.967H330.269V120.555H305.506Z"
              fill="#171717"
            />
          </g>
          <defs>
            <clipPath id="clip0_68_256">
              <rect width="335" height="132" fill="white" />
            </clipPath>
          </defs>
        </svg>
        <OnboardingInput
          label="Pronouns"
          placeholder="he/him"
          name="pronouns"
          value={formik.values?.pronouns}
          onChange={formik.handleChange}
          onBlur={formik.handleBlur}
          touched={formik.touched?.pronouns}
          error={formik.errors?.pronouns}
        />
        <OnboardingInput
          label="Professional Title"
          placeholder="Software Engineer"
          name="jobTitle"
          value={formik.values?.jobTitle}
          onChange={formik.handleChange}
          onBlur={formik.handleBlur}
          touched={formik.touched?.jobTitle}
          error={formik.errors?.jobTitle}
        />
        <OnboardingInput
          label="Tagline"
          placeholder="Software Engineer & Amateur Boxer"
          name="andTitle"
          value={formik.values?.andTitle}
          onChange={formik.handleChange}
          onBlur={formik.handleBlur}
          touched={formik.touched?.andTitle}
          error={formik.errors?.andTitle}
        />
        <WhiteButton
          title={loading ? 'Updating your profile...' : 'Continue'}
          disabled={!formik.isValid || loading}
        />
      </form>
    </OnboardingHeader>
  );
};
