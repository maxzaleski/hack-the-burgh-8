import { OnboardingHeader, WhiteButton } from '../common';
import React from 'react';
import { OnboardingInput } from '../common/OnboardingInput';
import { API_USERS_PATH } from '@lib/common';
import { useAuth } from '@hooks';
import { useFormik } from 'formik';
import * as Yup from 'yup';
import router from 'next/router';

export const CompleteDetailsStep = (props) => {
  const [loading, setLoading] = React.useState(false);
  const { firebaseUser, tokenClaims } = useAuth();

  const formik = useFormik({
    initialValues: {
      pronouns: '',
      jobTitle: '',
      tagline: '',
    },
    validationSchema: Yup.object({
      jobTitle: Yup.string().required('Field is required'),
      tagline: Yup.string().required('Field is required'),
    }),
    onSubmit: (values) => {
      setLoading(true);
      fetch(API_USERS_PATH, {
        method: 'POST',
        headers: {
          'Content-type': 'application/json',
        },
        body: JSON.stringify({
          ...values,
          firebaseId: tokenClaims?.uid,
          eventId: tokenClaims?.event_id,
          name: firebaseUser?.displayName,
          email: firebaseUser?.email,
        }),
      })
        .then(() => router.push('/'))
        .catch((err) => console.log(err, err.stack))
        .finally(() => setLoading(false));
    },
  });

  return (
    <OnboardingHeader step="2/2">
      <form onSubmit={formik.handleSubmit} className="flex flex-col w-full">
        <svg
          width="295"
          height="116"
          viewBox="0 0 295 116"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          className="mb-[56px]">
          <g clipPath="url(#clip0_68_256)">
            <path
              d="M34.4439 24.4134H24.9399C24.8725 23.6234 24.6927 22.9068 24.4006 22.2634C24.1198 21.6201 23.7266 21.0671 23.221 20.6044C22.7267 20.1304 22.1257 19.7693 21.418 19.521C20.7102 19.2614 19.907 19.1316 19.0082 19.1316C17.4355 19.1316 16.1042 19.5154 15.0145 20.2828C13.936 21.0502 13.1159 22.1506 12.5542 23.5839C12.0038 25.0172 11.7285 26.7383 11.7285 28.7471C11.7285 30.8689 12.0094 32.6464 12.5711 34.0797C13.144 35.5017 13.9697 36.5739 15.0482 37.2962C16.1266 38.0071 17.4243 38.3627 18.9409 38.3627C19.8058 38.3627 20.581 38.2554 21.2663 38.041C21.9516 37.8153 22.547 37.4936 23.0525 37.0761C23.558 36.6585 23.9681 36.1563 24.2826 35.5694C24.6085 34.9712 24.8275 34.2998 24.9399 33.5549L34.4439 33.6226C34.3316 35.0898 33.9216 36.5852 33.2138 38.1087C32.5061 39.621 31.5006 41.0205 30.1974 42.307C28.9055 43.5823 27.3046 44.6093 25.3949 45.388C23.485 46.1668 21.2663 46.5561 18.7386 46.5561C15.5706 46.5561 12.7284 45.8733 10.2119 44.5078C7.70667 43.1422 5.72384 41.1333 4.26339 38.4811C2.81419 35.829 2.08959 32.5843 2.08959 28.7471C2.08959 24.8874 2.83104 21.6371 4.31395 18.9962C5.79686 16.344 7.79653 14.3408 10.313 12.9865C12.8294 11.6209 15.638 10.9381 18.7386 10.9381C20.9181 10.9381 22.9234 11.2372 24.7545 11.8354C26.5857 12.4335 28.1921 13.3082 29.574 14.4593C30.9557 15.5992 32.068 17.0043 32.9105 18.6746C33.7531 20.3448 34.2642 22.2578 34.4439 24.4134ZM50.3504 46.5561C47.5418 46.5561 45.1377 45.9975 43.138 44.8802C41.1384 43.7516 39.6048 42.1829 38.5376 40.174C37.4704 38.1539 36.9368 35.8121 36.9368 33.1486C36.9368 30.4851 37.4704 28.149 38.5376 26.1401C39.6048 24.12 41.1384 22.5512 43.138 21.434C45.1377 20.3053 47.5418 19.7411 50.3504 19.7411C53.1589 19.7411 55.563 20.3053 57.5627 21.434C59.5623 22.5512 61.0958 24.12 62.1631 26.1401C63.2303 28.149 63.7639 30.4851 63.7639 33.1486C63.7639 35.8121 63.2303 38.1539 62.1631 40.174C61.0958 42.1829 59.5623 43.7516 57.5627 44.8802C55.563 45.9975 53.1589 46.5561 50.3504 46.5561ZM50.4177 39.6492C51.2041 39.6492 51.8838 39.384 52.4567 38.8536C53.0297 38.3232 53.4734 37.567 53.788 36.5852C54.1026 35.6033 54.2599 34.4352 54.2599 33.0809C54.2599 31.7153 54.1026 30.5472 53.788 29.5767C53.4734 28.5948 53.0297 27.8387 52.4567 27.3082C51.8838 26.7778 51.2041 26.5125 50.4177 26.5125C49.5864 26.5125 48.8731 26.7778 48.2776 27.3082C47.6822 27.8387 47.2272 28.5948 46.9127 29.5767C46.5982 30.5472 46.4409 31.7153 46.4409 33.0809C46.4409 34.4352 46.5982 35.6033 46.9127 36.5852C47.2272 37.567 47.6822 38.3232 48.2776 38.8536C48.8731 39.384 49.5864 39.6492 50.4177 39.6492ZM66.5895 46.0821V20.0796H75.4196V25.0228H75.6892C76.2284 23.3977 77.1496 22.1111 78.4528 21.1631C79.756 20.2151 81.3061 19.7411 83.1038 19.7411C84.9236 19.7411 86.4912 20.2264 87.8056 21.197C89.1193 22.1563 89.9118 23.4315 90.1814 25.0228H90.4511C90.8893 23.4315 91.8217 22.1563 93.2485 21.197C94.6753 20.2264 96.3488 19.7411 98.2698 19.7411C100.752 19.7411 102.764 20.5424 104.303 22.145C105.853 23.7475 106.628 25.8806 106.628 28.544V46.0821H97.3263V30.914C97.3263 29.7741 97.04 28.8826 96.4666 28.2393C95.894 27.5847 95.1245 27.2574 94.158 27.2574C93.2034 27.2574 92.445 27.5847 91.8834 28.2393C91.333 28.8826 91.0577 29.7741 91.0577 30.914V46.0821H82.1603V30.914C82.1603 29.7741 81.874 28.8826 81.3006 28.2393C80.728 27.5847 79.9585 27.2574 78.9921 27.2574C78.3517 27.2574 77.8013 27.4042 77.3406 27.6976C76.88 27.991 76.5206 28.4142 76.2621 28.9672C76.015 29.5089 75.8914 30.1579 75.8914 30.914V46.0821H66.5895ZM110.267 55.833V20.0796H119.501V24.6166H119.704C120.041 23.7362 120.535 22.9293 121.187 22.1958C121.838 21.4509 122.646 20.8583 123.613 20.4182C124.579 19.9668 125.702 19.7411 126.983 19.7411C128.69 19.7411 130.314 20.1982 131.853 21.1123C133.403 22.0264 134.662 23.4654 135.628 25.4291C136.606 27.3929 137.094 29.9434 137.094 33.0809C137.094 36.0829 136.628 38.5715 135.695 40.5465C134.774 42.5215 133.539 43.9943 131.988 44.9649C130.449 45.9354 128.758 46.4207 126.916 46.4207C125.702 46.4207 124.618 46.2232 123.664 45.8282C122.72 45.4219 121.911 44.8745 121.237 44.1861C120.574 43.4864 120.063 42.6964 119.704 41.8161H119.568V55.833H110.267ZM119.367 33.0809C119.367 34.3449 119.53 35.4396 119.855 36.3651C120.192 37.2792 120.664 37.9902 121.27 38.498C121.889 38.9946 122.624 39.2429 123.478 39.2429C124.332 39.2429 125.056 39.0003 125.652 38.515C126.258 38.0185 126.72 37.3131 127.034 36.3989C127.359 35.4735 127.522 34.3675 127.522 33.0809C127.522 31.7943 127.359 30.6939 127.034 29.7798C126.72 28.8544 126.258 28.149 125.652 27.6637C125.056 27.1671 124.332 26.9189 123.478 26.9189C122.624 26.9189 121.889 27.1671 121.27 27.6637C120.664 28.149 120.192 28.8544 119.855 29.7798C119.53 30.6939 119.367 31.7943 119.367 33.0809ZM149.344 11.4121V46.0821H140.042V11.4121H149.344ZM165.536 46.5561C162.773 46.5561 160.391 46.0257 158.391 44.9649C156.403 43.8927 154.869 42.3578 153.792 40.3602C152.724 38.3514 152.19 35.9475 152.19 33.1486C152.19 30.4626 152.729 28.1152 153.808 26.1063C154.886 24.0974 156.409 22.5343 158.375 21.417C160.341 20.2997 162.66 19.7411 165.334 19.7411C167.289 19.7411 169.059 20.0458 170.642 20.6553C172.226 21.2647 173.58 22.1506 174.703 23.313C175.827 24.4642 176.692 25.8637 177.299 27.5113C177.906 29.1591 178.208 31.0156 178.208 33.0809V35.2477H155.089V30.1015H169.648C169.637 29.3566 169.446 28.702 169.075 28.1377C168.716 27.5621 168.227 27.1164 167.609 26.8003C167.002 26.4731 166.312 26.3094 165.536 26.3094C164.784 26.3094 164.093 26.4731 163.464 26.8003C162.834 27.1164 162.329 27.5565 161.947 28.1208C161.576 28.6851 161.38 29.3453 161.357 30.1015V35.6541C161.357 36.4892 161.531 37.234 161.88 37.8886C162.228 38.5432 162.728 39.0567 163.379 39.4291C164.031 39.8016 164.817 39.9878 165.739 39.9878C166.379 39.9878 166.963 39.8975 167.491 39.7169C168.031 39.5364 168.491 39.2768 168.873 38.9382C169.255 38.5884 169.536 38.1708 169.715 37.6855H178.208C177.917 39.4912 177.225 41.06 176.136 42.3917C175.047 43.7121 173.602 44.7392 171.805 45.4727C170.019 46.195 167.929 46.5561 165.536 46.5561ZM196.491 20.0796V26.8512H179.438V20.0796H196.491ZM182.74 13.8499H192.043V37.7193C192.043 38.0805 192.104 38.3852 192.228 38.6335C192.351 38.8705 192.542 39.0511 192.8 39.1752C193.059 39.2881 193.39 39.3445 193.794 39.3445C194.076 39.3445 194.401 39.3107 194.772 39.2429C195.154 39.1752 195.435 39.1188 195.615 39.0737L196.963 45.642C196.548 45.7662 195.952 45.9185 195.177 46.0991C194.413 46.2797 193.503 46.3981 192.447 46.4546C190.312 46.5674 188.52 46.3473 187.071 45.7944C185.622 45.2301 184.532 44.3441 183.802 43.1365C183.072 41.9289 182.718 40.4166 182.74 38.5997V13.8499ZM211.462 46.5561C208.699 46.5561 206.317 46.0257 204.317 44.9649C202.329 43.8927 200.795 42.3578 199.717 40.3602C198.65 38.3514 198.116 35.9475 198.116 33.1486C198.116 30.4626 198.655 28.1152 199.734 26.1063C200.812 24.0974 202.334 22.5343 204.301 21.417C206.267 20.2997 208.586 19.7411 211.26 19.7411C213.215 19.7411 214.984 20.0458 216.568 20.6553C218.152 21.2647 219.506 22.1506 220.629 23.313C221.753 24.4642 222.617 25.8637 223.224 27.5113C223.831 29.1591 224.134 31.0156 224.134 33.0809V35.2477H201.014V30.1015H215.574C215.563 29.3566 215.371 28.702 215.001 28.1377C214.641 27.5621 214.153 27.1164 213.535 26.8003C212.928 26.4731 212.237 26.3094 211.462 26.3094C210.709 26.3094 210.019 26.4731 209.389 26.8003C208.76 27.1164 208.255 27.5565 207.873 28.1208C207.502 28.6851 207.305 29.3453 207.283 30.1015V35.6541C207.283 36.4892 207.457 37.234 207.806 37.8886C208.154 38.5432 208.654 39.0567 209.305 39.4291C209.957 39.8016 210.743 39.9878 211.665 39.9878C212.304 39.9878 212.889 39.8975 213.417 39.7169C213.956 39.5364 214.417 39.2768 214.799 38.9382C215.181 38.5884 215.462 38.1708 215.641 37.6855H224.134C223.843 39.4912 223.151 41.06 222.061 42.3917C220.972 43.7121 219.528 44.7392 217.731 45.4727C215.945 46.195 213.855 46.5561 211.462 46.5561ZM8.02119 113.833C6.95397 113.833 5.93728 113.748 4.97115 113.579C4.00501 113.421 3.15683 113.201 2.42661 112.919L4.44876 106.283C5.21268 106.554 5.9092 106.729 6.53832 106.807C7.17866 106.887 7.72352 106.841 8.17288 106.672C8.63349 106.503 8.96487 106.181 9.1671 105.707L9.36933 105.233L0.269653 78.0796H9.97594L14.155 96.0916H14.4247L18.6712 78.0796H28.4449L19.0082 106.249C18.5364 107.682 17.8511 108.969 16.9524 110.109C16.0649 111.26 14.8965 112.169 13.4473 112.835C11.9982 113.5 10.1894 113.833 8.02119 113.833ZM41.8236 104.556C39.0151 104.556 36.611 103.997 34.6113 102.88C32.6116 101.752 31.0782 100.183 30.0109 98.1741C28.9436 96.1536 28.41 93.8122 28.41 91.1489C28.41 88.4849 28.9436 86.149 30.0109 84.1405C31.0782 82.12 32.6116 80.5516 34.6113 79.434C36.611 78.3053 39.0151 77.7411 41.8236 77.7411C44.6322 77.7411 47.0362 78.3053 49.0359 79.434C51.0357 80.5516 52.5691 82.12 53.6363 84.1405C54.7035 86.149 55.2372 88.4849 55.2372 91.1489C55.2372 93.8122 54.7035 96.1536 53.6363 98.1741C52.5691 100.183 51.0357 101.752 49.0359 102.88C47.0362 103.997 44.6322 104.556 41.8236 104.556ZM41.8911 97.6489C42.6774 97.6489 43.3571 97.3843 43.93 96.8536C44.503 96.3228 44.9467 95.5673 45.2613 94.5852C45.5758 93.6032 45.7331 92.4353 45.7331 91.0806C45.7331 89.7156 45.5758 88.5469 45.2613 87.5768C44.9467 86.5947 44.503 85.8384 43.93 85.3084C43.3571 84.7777 42.6774 84.5123 41.8911 84.5123C41.0597 84.5123 40.3463 84.7777 39.7509 85.3084C39.1555 85.8384 38.7006 86.5947 38.3859 87.5768C38.0714 88.5469 37.9141 89.7156 37.9141 91.0806C37.9141 92.4353 38.0714 93.6032 38.3859 94.5852C38.7006 95.5673 39.1555 96.3228 39.7509 96.8536C40.3463 97.3843 41.0597 97.6489 41.8911 97.6489ZM74.8467 92.7062V78.0796H84.1486V104.082H75.3185V99.1386H75.0489C74.4871 100.798 73.5041 102.096 72.0999 103.033C70.6956 103.958 69.0273 104.421 67.0951 104.421C65.2864 104.421 63.7024 104.003 62.343 103.168C60.995 102.333 59.9445 101.181 59.1918 99.7147C58.4504 98.2472 58.0741 96.566 58.0628 94.6694V78.0796H67.3647V92.7062C67.376 93.9925 67.7017 95.0024 68.342 95.7365C68.9936 96.4698 69.9036 96.8369 71.0719 96.8369C71.8472 96.8369 72.5155 96.6732 73.0773 96.3459C73.6502 96.0074 74.0884 95.5331 74.3917 94.9237C74.7062 94.3032 74.8579 93.5635 74.8467 92.7062ZM87.9306 104.082V78.0796H96.9625V83.0226H97.2322C97.7043 81.1944 98.4509 79.8572 99.4736 79.0107C100.507 78.1643 101.715 77.7411 103.097 77.7411C103.501 77.7411 103.9 77.7749 104.293 77.8426C104.697 77.8991 105.085 77.9837 105.456 78.0965V86.0704C104.996 85.9122 104.428 85.7939 103.754 85.7144C103.08 85.6358 102.501 85.596 102.018 85.596C101.108 85.596 100.288 85.805 99.5582 86.2221C98.8385 86.6289 98.2714 87.2041 97.8562 87.9494C97.4402 88.6827 97.2322 89.5464 97.2322 90.5395V104.082H87.9306Z"
              fill="white"
            />
            <path d="M298.893 65.7094H117.842V115.441H298.893V65.7094Z" fill="white" />
            <path
              d="M125.253 105.942V75.4629H138.349C140.601 75.4629 142.571 75.9093 144.26 76.8023C145.949 77.6952 147.263 78.9503 148.201 80.5676C149.139 82.1844 149.608 84.0746 149.608 86.2373C149.608 88.4206 149.124 90.3108 148.156 91.9078C147.199 93.5056 145.85 94.7355 144.112 95.5983C142.384 96.462 140.364 96.8934 138.053 96.8934H130.231V90.4641H136.394C137.362 90.4641 138.187 90.2957 138.867 89.958C139.559 89.6108 140.087 89.1198 140.453 88.485C140.828 87.8502 141.016 87.1009 141.016 86.2373C141.016 85.3649 140.828 84.6204 140.453 84.0055C140.087 83.3802 139.559 82.9043 138.867 82.5769C138.187 82.2393 137.362 82.0708 136.394 82.0708H133.49V105.942H125.253ZM151.796 105.942V75.4629H164.892C167.143 75.4629 169.114 75.8746 170.803 76.6981C172.491 77.5216 173.805 78.7072 174.743 80.2553C175.682 81.8031 176.151 83.6583 176.151 85.821C176.151 88.0035 175.667 89.8444 174.698 91.3421C173.741 92.8405 172.392 93.9719 170.655 94.7355C168.926 95.499 166.906 95.8812 164.596 95.8812H156.774V89.4519H162.936C163.904 89.4519 164.729 89.3335 165.41 89.0952C166.102 88.8473 166.63 88.4548 166.995 87.9193C167.37 87.3838 167.558 86.6838 167.558 85.821C167.558 84.9478 167.37 84.2383 166.995 83.6924C166.63 83.1371 166.102 82.7303 165.41 82.4728C164.729 82.2043 163.904 82.0708 162.936 82.0708H160.032V105.942H151.796ZM169.573 91.9523L177.158 105.942H168.21L160.803 91.9523H169.573ZM208.219 90.7025C208.219 94.0951 207.562 96.9578 206.248 99.2897C204.935 101.611 203.162 103.373 200.93 104.572C198.698 105.763 196.209 106.359 193.464 106.359C190.698 106.359 188.2 105.759 185.968 104.558C183.745 103.347 181.978 101.582 180.664 99.2595C179.361 96.9284 178.708 94.0752 178.708 90.7025C178.708 87.3091 179.361 84.452 180.664 82.1304C181.978 79.7985 183.745 78.0375 185.968 76.8469C188.2 75.6464 190.698 75.0461 193.464 75.0461C196.209 75.0461 198.698 75.6464 200.93 76.8469C203.162 78.0375 204.935 79.7985 206.248 82.1304C207.562 84.452 208.219 87.3091 208.219 90.7025ZM199.745 90.7025C199.745 88.8767 199.503 87.3393 199.019 86.0887C198.545 84.8286 197.839 83.876 196.9 83.2316C195.973 82.5769 194.827 82.2496 193.464 82.2496C192.1 82.2496 190.95 82.5769 190.012 83.2316C189.084 83.876 188.378 84.8286 187.894 86.0887C187.419 87.3393 187.183 88.8767 187.183 90.7025C187.183 92.5283 187.419 94.0713 187.894 95.3306C188.378 96.5811 189.084 97.533 190.012 98.1885C190.95 98.8328 192.1 99.1554 193.464 99.1554C194.827 99.1554 195.973 98.8328 196.9 98.1885C197.839 97.533 198.545 96.5811 199.019 95.3306C199.503 94.0713 199.745 92.5283 199.745 90.7025ZM211.195 105.942V75.4629H232.528V82.1304H219.432V87.3687H231.224V94.0363H219.432V105.942H211.195ZM242.96 75.4629V105.942H234.723V75.4629H242.96ZM246.029 105.942V75.4629H254.265V99.2746H266.532V105.942H246.029ZM269.027 105.942V75.4629H290.893V82.1304H277.264V87.3687H289.767V94.0363H277.264V99.2746H290.834V105.942H269.027Z"
              fill="#171717"
            />
          </g>
          <defs>
            <clipPath id="clip0_68_256">
              <rect width="295" height="116" fill="white" />
            </clipPath>
          </defs>
        </svg>

        <OnboardingInput
          label="Pronouns"
          placeholder="he/him"
          name="pronouns"
          value={formik.values?.pronouns}
          onChange={formik.handleChange}
          onBlur={formik.handleBlur}
          touched={formik.touched?.pronouns}
          error={formik.errors?.pronouns}
        />
        <OnboardingInput
          label="Professional Title"
          placeholder="Software Engineer"
          name="jobTitle"
          value={formik.values?.jobTitle}
          onChange={formik.handleChange}
          onBlur={formik.handleBlur}
          touched={formik.touched?.jobTitle}
          error={formik.errors?.jobTitle}
        />
        <OnboardingInput
          label="Tagline"
          placeholder="Software Engineer & Amateur Boxer"
          name="tagline"
          value={formik.values?.tagline}
          onChange={formik.handleChange}
          onBlur={formik.handleBlur}
          touched={formik.touched?.tagline}
          error={formik.errors?.tagline}
        />
        <WhiteButton
          title={loading ? 'Updating your profile...' : 'Continue'}
          disabled={!formik.isValid || loading}
        />
      </form>
    </OnboardingHeader>
  );
};
